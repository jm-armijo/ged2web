<!DOCTYPE html>
<html lang="en">
    <%= self.build_header('tree') %>
    <body onload="document.getElementById('focus').focus();">
        <%= self.build_banner %>
        <div class="content">
            <% instance.generations.each_with_index do |generation, generation_number| %>
            <div class='generation'>
                <% generation.nodes.each_with_index do |node, node_number| %>
                    <% if node.class.name == 'Placeholder' %>
                <div class='placeholder' style="width: <%= ((1 + Math.log(node.size) ) ** 2 ) * 200 %>px; ">
                </div>
                    <% else %>
                        <% if generation_number.zero? && node_number == generation.nodes.length / 2 %>
                <div class='node' id='focus' tabindex='0'>
                        <% else %>
                <div class='node'>
                        <% end %>
                        <% node.unions.each_with_index do |link, index| %>
                            <% if index % 2 == 0; person = link %>
                        <div class="person" id="<%= person.id %>">
                            <div class="id">
                                <%= person.id %>
                            </div>
                            <div class="first-name">
                                <%= person.first_name %>
                            </div>
                            <div class="last-name">
                                <%= person.last_name %>
                            </div>
                        </div>
                            <% else; family = link %>
                        <div class="family" id="<%= family.id %>">
                            <div class="id">
                                <%= family.id %>
                            </div>
                        </div>
                            <% end %>
                        <% end %>
                </div>
                    <% end %>
                <% end %>
            </div>
            <% end %>
        </div>
        <script>
            window.addEventListener(
                "load",
                function() {
                    "use strict";
                    <%
                    instance.generations.each do |generation|
                        generation.nodes.each do |node|
                            next if node.class.name == 'Placeholder'

                            node.persons.each do |person|
                                person.parents.each do |parent|
                                    next if parent.class.name == 'NullFamily'
                    %>
                    new LeaderLine (
                        document.getElementById('<%= person.id %>'),
                        document.getElementById('<%= parent.id %>'),
                        {
                            color: "Black",
                            startSocket: "bottom",
                            endSocket: "top",
                            path: "magnet",
                            size: 2,
                            startPlug: "square",
                            endPlug: "square"
                        }
                    );

                    <%
                                end
                            end
                        end
                    end
                    %>
                }
            );
        </script>
    </body>
</html>
